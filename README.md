# Концепция безопасности системы "Робот-фармацевт"

## 1. Карточка описания назначения и применения продукта
![L](diagrams/M37.PNG)
- **Продукт**: Робот-фармацевт, который производит лекарство по индивидуальному рецепту.
- **Рецепт включает в себя**:
  а) Точный состав и количество компонентов, порядок и условия изготовления конечного продукта.  
  б) Уникальный идентификатор лекарства, который изготавливается в определённом объёме для индивидуального курса лечения.

## 2. Активы и риски
| Актив               | Угроза                                    | Уязвимость               | Последствие                 |
|---------------------|-------------------------------------------|--------------------------|-----------------------------|
| **Лекарство**       | Нарушение техпроцесса                    | Ошибки в ПО/датчиках     | Вред здоровью пациентов     |
| **Рецептура**       | Утечка коммерческой тайны                | Слабая аутентификация    | Утрата конкурентного преимущества |
| **Персональные данные** | Несанкционированный доступ          | Отсутствие шифрования    | Штрафы до 5% оборота        |
| **Робот**           | Отказ оборудования                       | Износ компонентов        | Простой производства        |
| **Пациенты**        | Приём неправильного лекарства            | Человеческий фактор      | Юридические последствия     |


## 3. Цели безопасности

## 3. Цели безопасности

| Цель безопасности | Реализация |
|-------------------|------------|
| **ЦБ1:** Состав производимых лекарств всегда точно соответствует рецепту (актив: корректность состава) | Цифровая подпись рецептов (ECDSA), контроль датчиками состава |
| **ЦБ2:** Рецептурные данные никогда не раскрываются неавторизованным лицам (актив: конфиденциальность данных) | Шифрование (AES-256 + HSM), двухфакторная аутентификация |

## 4. Соотнесение ценностей и целей
| Ценность               | Негативное событие                          | Оценка ущерба       | Цель безопасности |
|------------------------|---------------------------------------------|---------------------|-------------------|
| **Здоровье пациентов** | Приём бракованного лекарства                | Высокий    | ЦБ1              |
| **Коммерческая тайна** | Утечка рецептуры конкурентам               | Высокий            | ЦБ2              |

<!-- DELETE: Удалены общие предположения -->
<!-- ADD: Конкретные предположения -->
## 5. Предположения безопасности
- **Физическая безопасность**: Робот и серверы расположены в охраняемом помещении с контролем доступа.
- **Верификация рецептов**: Врачи клиники проверяют рецепты до передачи в систему.
- **Контроль персонала**: Все операторы проходят ежегодную проверку компетенций.
- **Стабильность сети**: Используется выделенный VLAN с приоритезацией трафика.

## 6. Сценарии функционирования
### 6.1 Нормальный процесс
![Сценарий](diagrams/m31.PNG)
- **Пациент** → **Оператор**: Предоставляет рецепт  
- **Оператор** → **Робот**: Вводит задание (проверка ЦБ2)  
- **Робот** → **Контроллер**: Инструкции с подписью (ЦБ1)  

### 6.2 Негативные сценарии
#### 6.2.1 Утечка рецептуры
![Сценарий](diagrams/2904.PNG)
**Нарушена цель**: ЦБ2  
**Сценарий**: Обход аутентификации → кража данных из БД.  
**Меры**: Усилить контроль доступа 

#### 6.2.2 Производство брака
![Архитектура](diagrams/3004.PNG)
**Нарушена цель**: ЦБ1  
**Сценарий**: Сбой датчика → неправильная дозировка.  
**Меры**: Внедрить дублирующие датчики.

### 7.Подсистемы

| Подсистема         | Роль в системе                                                                 |
|--------------------|--------------------------------------------------------------------------------|
| **Пациент**        | Источник требования на производство лекарства. Передаёт рецепт оператору.     |
| **Оператор**       | Вводит рецепт в систему, инициирует процесс производства.                     |
| **Аутентификация** | Проверяет двухфакторную аутентификацию оператора, управляет доступом.          |
| **База данных**    | Хранит зашифрованные рецепты и историю операций. Доступ только через HSM.     |
| **HSM**            | Хранит ключи, выполняет шифрование/подпись. Является доверенным компонентом.  |
| **Контроллер**     | Проверяет ЭЦП рецепта, формирует команды для робота. Повышает целостность.    |
| **Робот**          | Производит лекарства по командам. Недоверенный физический исполнитель.         |
| **Датчик состава** | Проверяет состав лекарства, подписывает результаты. Повышает целостность.      |

## 8. Архитектурная схема
![Архитектура](diagrams/архитуктурная.PNG)  


| Компоненты архитектурной схемы | Уровень доверия | Оценка сложности и размера | Обоснование                                                                      |
|-------------------------------|-----------------|------------------------|---------------------------------------------------------------------------------|
| Пациент                        | Недоверенный    | MM                     | Возможна подача некорректного рецепта, что нарушает ЦБ1                         |
| Оператор-фармацевт             | Недоверенный    | MM                     | Возможны ошибки при вводе данных, что нарушает ЦБ1                              |
| HSM                            | Доверенный      | SS                     | Ключевая проверка ЭЦП и целостности данных для обеспечения ЦБ1                  |
| Контроллер                     | Доверенный, повышает целостность    | SS                     | Возможны сбои в обработке команд, что может нарушить ЦБ1                        |
| Аутентификация                 | Недоверенный    | MM                     | Уязвимость 2FA может привести к несанкционированному доступу, нарушая ЦБ2       |
| База данных рецептов           | Недоверенный    | MM                     | Уязвимость базы может привести к утечке данных, нарушая ЦБ2                     |
| Робот                          | Недоверенный    | MM                     | Возможны технические сбои робота, влияющие на производственный процесс                 |
| Датчик состава                 | Доверенный, повышает целостность    | SS                     | Сбой проверки доступности может нарушить ЦБ1                                    |
## 9. Политика архитектуры с монитором
![Архитектура](diagrams/монитор.PNG) 
Код политики
    def check_policy(event_id, details):
    authorized = False
    print(f"[info] checking policies for event {event_id}: "
          f"{details['source']} → {details['deliver_to']}: {details['operation']}")

    src = details['source']
    dst = details['deliver_to']
    op = details['operation']

    # Пациент -> Оператор: запрос на получение лекарства
    if src == 'пациент' and dst == 'оператор' and op == 'запрос_лекарства':
        authorized = True

    # Оператор -> Аутентификация: ввод рецепта
    if src == 'оператор' and dst == 'аутентификация' and op == 'проверка_2FA':
        authorized = True

    # Аутентификация -> БД: запись зашифрованного рецепта
    if src == 'аутентификация' and dst == 'база_данных' and op == 'сохранение_рецепта':
        authorized = True

    # БД -> HSM: запрос расшифровки/подписи рецепта
    if src == 'база_данных' and dst == 'hsm' and op == 'расшифровка_рецепта':
        if details.get('signed', False):
            authorized = True

    # HSM -> Контроллер: передача проверенного рецепта
    if src == 'hsm' and dst == 'контроллер' and op == 'рецепт_подписан':
        authorized = True

    # Контроллер -> HSM: запрос подписи команды на производство
    if src == 'контроллер' and dst == 'hsm' and op == 'подписать_команду':
        authorized = True

    # HSM -> Робот: команда на производство
    if src == 'hsm' and dst == 'робот' and op == 'команда_производство':
        authorized = True

    # Робот -> Датчик состава: проверка результата
    if src == 'робот' and dst == 'датчик_состава' and op == 'анализ_лекарства':
        authorized = True

    # Датчик состава -> HSM: подписание состава
    if src == 'датчик_состава' and dst == 'hsm' and op == 'подписать_состав':
        if details.get('valid', False):
            authorized = True

    # HSM -> Робот: разрешение на выдачу
    if src == 'hsm' and dst == 'робот' and op == 'разрешить_выдачу':
        authorized = True

    # Робот -> Оператор: выдача лекарства
    if src == 'робот' and dst == 'оператор' and op == 'лекарство_готово':
        authorized = True

    # Оператор -> Пациент: передача лекарства
    if src == 'оператор' and dst == 'пациент' and op == 'выдать_лекарство':
        authorized = True

    return authorized


